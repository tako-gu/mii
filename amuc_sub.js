function isCanvasSupported(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}function addStyleRule(e,t){var a;if(document.styleSheets.length)a=document.styleSheets[document.styleSheets.length-1];else{var i=document.getElementsByTagName("head")[0];if(null==i)return;var c=document.createElement("style");i.appendChild(c),a=c.sheet}a.insertRule(e+"{"+t+"}",a.cssRules.length)}function DelStyleRule(){if(document.styleSheets.length){var e=document.styleSheets[document.styleSheets.length-1];e.deleteRule(e.length-1)}}function AddViewPort(e,t){for(var a=document.getElementsByTagName("meta"),i=1,c=0;c<a.length;c++){var r=a[c].getAttribute("name");if(r&&r.toLowerCase()===e){a[c].setAttribute("content",t),i=0;break}}if(i){var a=document.createElement("meta");a.setAttribute("name",e),a.setAttribute("content",t),document.getElementsByTagName("head")[0].appendChild(a)}}function DelViewPort(e){for(var t=document.getElementsByTagName("meta"),a=0;a<t.length;a++){var i=t[a].getAttribute("name");if(i&&i.toLowerCase()===e){t[a].removeAttribute("content"),t[a].removeAttribute("name");break}}}function vm_draw(){sc_wait||(vm_wait=1,DrawFlag&&Draw(),vm_wait=0)}function textSub(){if(tAnimeNow){switch(tAnimeNow){case 1:ClickFlag|SkipFlag&&(tAnimeNow=2,ClickFlag=0);break;case 2:WaitAniFlag=1,ClickFlag|SkipFlag&&(Wait=-1,ClickFlag=0,WaitAniFlag=0,tAnimeNow=3);break;case 4:return ClickFlag|SkipFlag&&(ClickFlag=0,WaitAniFlag=0,tAnimeNow=0),0;default:cnt=GetPmax(),AddSCadd(cnt+1),WaitAniFlag=0,tAnimeNow=0}return-1}return 0}function voicePlay(e){e.length?(VoiceFlag&&(voi[0].autoplay=1),voi[0].volume=VoiceVolume,VoiceName=isMP3?"voice/"+e+".mp3":"voice/"+e+".ogg",voi[0].src=VoiceName):(VoiceFlag&&(voi[0].autoplay=1),voi[0].src="",VoiceName=""),voiFadeT=0}function sc_run(){if(!vm_wait){if(run_wait){var e=(new Date).getTime();if(FadeAlpha=(e-FadeNow)/FadeTime,!(FadeAlpha>1||ClickFlag|SkipFlag))return;cnt=GetPmax(),FadeAlpha=1,AddSCadd(cnt+1),BackNo^=1,FadeFlag=0,ClickFlag|SkipFlag&&(ClickFlag=0,e=FadeNow+FadeTime,tAnimeNow=0),run_wait=0}if(se_wait){if(!se[PlaySeCh].ended)return;se[PlaySeCh].src="",cnt=GetPmax(),AddSCadd(cnt+1)}if(act_sync){for(var t=0,a=0;a<acl.length;a++)a!=act_syncNo&&-1!=act_syncNo||(t|=acl[a].status);return void(0==(1&t)&&(ActClrAll(act_syncNo),cnt=GetPmax(),AddSCadd(cnt+1),act_sync=0))}if(act_syncA){for(var t=0,a=0;a<acl.length;a++)t|=acl[a].status;return void(0==(1&t)&&(ActClrAll(),cnt=GetPmax(),AddSCadd(cnt+1),act_syncA=0))}if(NowTimeS=(new Date).getTime(),bgmFadeT){if(!(NowTimeS>bgmFadeS+bgmFadeT))return void(bgm[0].volume=BgmVolume*(bgmFadeT-(NowTimeS-bgmFadeS))/bgmFadeT);bgm[0].pause(),bgm[0].src="",bgmFadeT=0,bgmFadeS=0}if(voiFadeT){if(!(NowTimeS>voiFadeS+voiFadeT))return void(voi[0].volume=VoiceVolume*(voiFadeT-(NowTimeS-voiFadeS))/voiFadeT);voi[0].pause(),voi[0].src="",voiFadeT=0,voiFadeS=0}if(sc_wait=1,ScRead){if(btnSub(),textSub())return void(sc_wait=0);var i=sc_code[script[sc_step]];void 0===i?sc_code["default"]():i(),0>brNode&&(clearInterval(OrgInv1),clearInterval(OrgInv2)),sc_step>sno&&(clearInterval(OrgInv1),clearInterval(OrgInv2))}sc_wait=0}}function uniqueID(){var e=Math.floor(1e3*Math.random()),t=new Date,a=t.getTime();return e+a.toString()}function err(e){alert(e)}function errVal(e){err("変数が初期化されていません。["+e+"]")}function NewCg(e){e.cv=document.createElement("canvas"),e.cv.id=uniqueID(),e.eof=0,e.filter=0,e.render=0,e.scale=1,e.ex=0,e.ey=0,e.rx=0,e.ry=0,e.rz=0,e.status=0,e.etcv=NaN,e.etcx=NaN}function init(){if(OrgWid=document.body.clientWidth,cv1=document.getElementById("dc_canvas"),!cv1||!cv1.getContext)return!1;2!=SmaiiRate?(cv1.width=1280,cv1.height=720):(cv1.width=640,cv1.height=360),ctx1=cv1.getContext("2d"),ctx1.textBaseline="top",ctx1.fillStyle="rgb(0,0,0)",ctx1.fillRect(0,0,cv1.width,cv1.height),ctx1.fillStyle="rgb(255,255,255)",cv1.onmouseover=OnMouse,cv1.onmouseout=OffMouse,cv1.onclick=OnClick,window.addEventListener("keydown",OnKey,!0),window.addEventListener("keyup",OffKey,!0),cv1.addEventListener?cv1.addEventListener("mousemove",MouseMove):cv1.attachEvent("mousemove",MouseMove),ctx1.font=fontSize/SmaiiRate+"px "+fontType,cv[0]=document.createElement("canvas"),cv[0].id=uniqueID(),cv[0].width=cv1.width,cv[0].height=cv1.height,ctx[0]=cv[0].getContext("2d"),!ctx[0],ctx[0].fillStyle="rgb(0,0,0)",ctx[0].fillRect(0,0,cv1.width,cv1.height),cv[1]=document.createElement("canvas"),cv[1].id=uniqueID(),cv[1].width=cv1.width,cv[1].height=cv1.height,ctx[1]=cv[1].getContext("2d"),!ctx[1],ctx[1].fillStyle="rgb(0,0,0)",ctx[1].fillRect(0,0,cv1.width,cv1.height),cv[2]=document.createElement("canvas"),cv[2].id=uniqueID(),cv[2].width=namearea[2]/SmaiiRate,cv[2].height=namearea[3]/SmaiiRate,ctx[2]=cv[2].getContext("2d"),!ctx[2],ctx[2].font=fontSize/SmaiiRate+"px "+fontType,ctx[2].textBaseline="top",cv[3]=document.createElement("canvas"),cv[3].id=uniqueID(),cv[3].width=textarea[2]/SmaiiRate+100,cv[3].height=textarea[3]/SmaiiRate,ctx[3]=cv[3].getContext("2d"),!ctx[3],ctx[3].font=fontSize/SmaiiRate+"px "+fontType,ctx[3].textBaseline="top",movie=document.createElement("video"),movie.id=uniqueID(),selCg=new pict,NewCg(selCg),WaitCg=new pict,NewCg(WaitCg),cg[0]=new Array(full_layer),cg[1]=new Array(full_layer);for(var e=0;e<full_layer;e++)cg[e]=new pict,NewCg(cg[e]),icg[e]=new pict,NewCg(icg[e]);cg[TextLayer].cv.width=cv1.width,cg[TextLayer].cv.height=cv1.height,cg[TextLayer].ctx=cg[TextLayer].cv.getContext("2d"),cg[TextLayer].ctx.fillStyle="rgba(0,0,0,0)",cg[TextLayer].ctx.fillRect(0,0,cv1.width,cv1.height),cg[TextLayer].alpha=1,cg[TextLayer].eof=3,cg[TextLayer].x=0,cg[TextLayer].y=0;for(var e=0;e<max_bgm;e++)bgm[e]=document.createElement("audio"),bgm[e].id=uniqueID();for(var e=0;e<max_voi;e++)voi[e]=document.createElement("audio"),voi[e].id=uniqueID();for(var e=0;e<max_se;e++)se[e]=document.createElement("audio"),se[e].id=uniqueID();for(var e=0;e<act_line_max;e++)acl[e]=new actline,acl[e].act=Array(),acl[e].act_no=0,acl[e].status=0;ClickFlag=0,Wait=-1,wAnime=-1,tAnimeNow=0,WaitAniFlag=0,TextFlag=0,FadeFlag=0,FadeAlpha=0,brNode=0,loadcgs(WaitCg,"system/main_key"),FPSStart=(new Date).getTime(),FPSdisp=FPScnt=0,DrawFlag=0}function ReadFile(e){var t=(new Function("param","return "+ReadAfter+"(param)"),new XMLHttpRequest);t.open("GET",e,!0),t.onreadystatechange=function(){4==t.readyState&&(ReadData=t.responseText,ReadAfter(ReadData))},t.send(null)}function naCheck(e){return e.charCodeAt(0)>128?128:"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(e)}function ReadAfter(e){sno=0;var t=0,a=e.length;for(t=0;a>t;){var i,c=e.charAt(t);if(c+e.charAt(t+1)=="//")for(;"\n"!=c&&a>t;)c=e.charAt(t++);else{if(c+e.charAt(t+1)=="/*")for(;e.charAt(t)+e.charAt(t+1)!="*/"&&a>t;)t++;switch(c){case'"':for(t++,i="",c=e.charAt(t++);'"'!=c&&a>t;)"\\"===c&&(c=e.charAt(t++),"n"===c&&(c="\n")),i+=c,c=e.charAt(t++);script.push(i),sno++;break;default:if(-1!=naCheck(c)||-1!="_=*-+%&|^<>".indexOf(c)){i="";for(var r=1;a>t&&e.charCodeAt(t)>=32&&-1==",();:".indexOf(c)&&1==r;)if(i+=c,t++,c=e.charAt(t)," "==c&&t){var n=e.charAt(t-1);if(-1!=naCheck(n))for(;" "==c&&a>t;){var o=e.charAt(t+1);if(-1!=naCheck(o)||-1!=",();:{}".indexOf(o)){t++,c=o,r=0;break}t++,c=o}else t++,c=e.charAt(t)}script.push(i),":"==c&&(lab_add.push(sno),lab_dat.push(i),labNo++),sno++}else-1!="{}()".indexOf(c)&&(script.push(c),sno++),t++}}}script[sno]=999,brNo=0;for(var l=0,g=new Array,s=0;sno>s;s++)switch(script[s]){case"start":start_add=sc_step=s;break;case"{":bracketS.push(s),g.push(brNo),brNo++,brNode++;break;case"}":1>brNode&&err("括弧不対応"),brNode--,l=g.pop(),bracketE[l]=s;break;case"sub":var m=sub_dat.length,v=0;s++,sub_dat.push(script[s]),sub_param[m]=[];var d=s+1;if("("==script[s+1]){for(d++;")"!=script[d];)sub_param[m].push(script[d++]),v++;d++}sub_add.push(d),subNo++}ScRead=1}function OnMouse(){}function OffMouse(){mouse_x=-1,mouse_y=-1}function OnClick(){var e=btnChk();if(-1!=e){var t=e>>16;e&=65535,btng[t].btn[e].click=1}else key_off||(ClickFlag=1)}function OnKey(e){17==e.keyCode&&(key_off||(SkipFlag=1))}function OffKey(e){17==e.keyCode&&(SkipFlag=0)}function MouseMove(e){var t,a,i=cv1.clientWidth/cv1.width;isIE||isFOX?(t=document.documentElement.scrollLeft,a=document.documentElement.scrollTop):(t=document.body.scrollLeft,a=document.body.scrollTop),mouse_x=Math.floor((e.clientX-cv1.offsetLeft+t)/i),mouse_y=Math.floor((e.clientY-cv1.offsetTop+a)/i)}function FPSdraw(){if(FpsFlag){var e=(new Date).getTime();FPScnt++,ctx1.fillText("FPS:"+FPSdisp,0,0),ctx1.fillText(mouse_x+":"+mouse_y,0,20);var t=cv1.clientWidth/cv1.width;ctx1.fillText(t,0,40),ctx1.fillText(isMP3,0,60),e-FPSStart>1e3&&(FPSdisp=FPScnt,FPScnt=0,FPSStart=e)}}function GetFontSize(e){var t=TextMoji.charCodeAt(e);return 256>t||t>=65377&&65439>=t?fontSize/2/SmaiiRate+3:fontSize/SmaiiRate+3}function textMake(){var e;e=cg[TextLayer],e.ctx.clearRect(0,0,e.cv.width,e.cv.height),e=icg[TextLayer],e.ctx.clearRect(0,0,e.cv.width,e.cv.height),TextSize=TextMoji.length,ctx[2].clearRect(0,0,namearea[2]/SmaiiRate,namearea[3]/SmaiiRate),NameMoji.length?(NameTagFlag=1,NameTag(1),TextBkFkag&&(ctx[2].fillStyle=nameBk,ctx[2].fillText(NameMoji,0,0),ctx[2].fillText(NameMoji,2,0),ctx[2].fillText(NameMoji,0,2),ctx[2].fillText(NameMoji,2,2)),ctx[2].fillStyle=nameCol,ctx[2].fillText(NameMoji,1,1)):(NameTagFlag=0,NameTag(0)),ctx[3].clearRect(0,0,textarea[2]/SmaiiRate,textarea[3]/SmaiiRate);for(var t=0,a=0,i=0;TextSize>i;i++)if(c=TextMoji.charAt(i),"<"===c)for(c=TextMoji.charAt(++i);">"!=c;)c=TextMoji.charAt(++i);else"\n"===c?(t=0,a+=(fontSize+8)/SmaiiRate):(TextBkFkag&&(ctx[3].fillStyle=textBk,ctx[3].fillText(c,t,a),ctx[3].fillText(c,t+2,a),ctx[3].fillText(c,t,a+2),ctx[3].fillText(c,t+2,a+2)),ctx[3].fillStyle=textCol,ctx[3].fillText(c,t+1,a+1),t+=GetFontSize(i),TextSize>i&&t+GetFontSize(i+1)>textarea[2]/SmaiiRate&&(t=0,a+=(fontSize+8)/SmaiiRate))}function TextAnime(){for(var e,t=(new Date).getTime(),a=0,i=0,r=0;TextSize>r;r++)if(c=TextMoji.charAt(r),"\n"===c)a=0,i+=(fontSize+8)/SmaiiRate;else{1!=tAnimeNow&&4!=tAnimeNow||(e=(t-TextStime)/TextTime-.25*r,0>e?e=0:e>1&&(e=1),icg[TextLayer].ctx.globalAlpha=e);var n=GetFontSize(r);icg[TextLayer].ctx.drawImage(cv[3],a,i,n,fontSize/SmaiiRate,textarea[0]/SmaiiRate+a,textarea[1]/SmaiiRate+i,n,fontSize/SmaiiRate),icg[TextLayer].ctx.globalAlpha=1,a+=n,TextSize>r&&a+GetFontSize(r+1)>textarea[2]/SmaiiRate&&(a=0,i+=(fontSize+8)/SmaiiRate),waitpos[0]=a,waitpos[1]=i}1===e&&(1===tAnimeNow&&(tAnimeNow=2),4===tAnimeNow&&(tAnimeNow=0))}function WaitAnime(){if(-1===wAnime)SwAnime=(new Date).getTime(),wAnime=0,wAniW=WaitCg.cv.width/waitanime[0],wAniH=WaitCg.cv.height;else{var e=(new Date).getTime();ctx1.drawImage(WaitCg.cv,wAnime*wAniW,0,wAniW,wAniH,textarea[0]/SmaiiRate+waitpos[0],textarea[1]/SmaiiRate+waitpos[1],wAniW,wAniH),e-SwAnime>waitanime[1]&&(SwAnime=e,wAnime++,wAnime>=waitanime[0]&&(wAnime=0))}}function GetSCParam0(e){var t;if("("==script[sc_step+1]){for(var a,a=2;e+1>a;a++)if(")"==script[sc_step+a])return 0;t=script[sc_step+a]}else t=script[sc_step+e];return t}function GetSCName(e){var t=varfnd(GetSCParam0(e));return-1==t?GetSCParam0(e):var_data[t]}function GetSCParam(e){var t=GetSCParam0(e);return t.length?GetParam(t,0):t}function AddSCadd(e){if("("==script[sc_step+1]){for(var t=2;e+1>t;t++)if(")"==script[sc_step+t])return void(sc_step+=t+1);sc_step+=e+2}else sc_step+=e}function GetPmax(){var e=0;if("("==script[sc_step+1])for(;")"!=script[sc_step+e+2];)e++;return e}function cg_del(e){if(3===e.eof){if(e.eof=0,isNaN(e.etcv)){e.etcv.width=0,e.etcv.height=0;var t=document.getElementById(e.etcv.id);t&&document.body.removeChild(t),delete e.etcv,e.etcv=NaN}void 0!=e.img&&(e.img.src="",e.ctx.clearRect(0,0,e.cv.width,e.cv.height),e.img.width=0,e.img.height=0,delete e.img),e.status=1,e.cv.width=0,e.cv.height=0,delete e.ctx}}function cg_cls(e){for(var t=0;t<max_layer;t++)3!==cg[t].eof||e!=t&&-1!=e||cg_del(cg[t])}function loadcgs(e,t){if(e.fname=t,e.mflag&&(delete e.movie,e.mflag=0),0===e.eof){if(e.ctx=e.cv.getContext("2d"),!e.ctx,e.alpha=1,e.filter=0,e.render=0,e.mflag=0,e.scale=1,e.rx=0,e.ry=0,e.rz=0,e.ex=0,e.ey=0,e.x=0,e.y=0,e.status=0,e.etcv=NaN,e.etcx=NaN,"_"==t.charAt(0)&&"F"==t.charAt(1)&&(t=t.replace(/_F\"/g,'"'),t=t.replace(/\"/g,"")),"#"==t.charAt(0)){e.cv.width=2*cv1.width,e.cv.height=2*cv1.height;var a=parseInt("0x"+t.substring(1,3))/255,i=parseInt("0x"+t.substring(3,5)),c=parseInt("0x"+t.substring(5,7)),r=parseInt("0x"+t.substring(7,9));return e.ctx.fillStyle="rgba("+i+","+c+","+r+","+a+")",e.ctx.fillRect(0,0,e.cv.width,e.cv.height),void(e.eof=3)}var n;n=path[SmaiiRate]+t,e.img=new Image,e.img.onload=function(){void 0!=e.img&&2===e.eof&&(e.cv.width=e.img.width,e.cv.height=e.img.height,e.ctx.clearRect(0,0,e.cv.width,e.cv.height),e.ctx.drawImage(e.img,0,0),delete e.img,e.eof=3)},e.img.src=n+".png",e.eof=2}}function loadcg(e,t){loadcgs(cg[e],t)}function set_pos(e,t,a){cg[e].x=t,cg[e].y=a}function set_alpha(e,t){cg[e].alpha=t}function set_render(e,t){cg[e].render=t}function set_filter(e,t){if(e.filter=t,t){var a=e.cv.width,i=e.cv.height;if(0==a||0==i)return;var c=e.ctx.getImageData(0,0,a,i),r=c.data;switch(t){case 1:for(var n=0;n<r.length;n+=4){var o=.298912*r[n]+.586611*r[n+1]+.114478*r[n+2];r[n]=Math.floor(.941*o),r[n+1]=Math.floor(.784*o),r[n+2]=Math.floor(.568*o)}break;case 2:for(var n=0;n<r.length;n+=4){var o=Math.floor(.298912*r[n]+.586611*r[n+1]+.114478*r[n+2]);r[n]=o,r[n+1]=o,r[n+2]=o}break;case 3:break;case 4:for(var n=0;n<r.length;n+=4)r[n]^=255,r[n+1]^=255,r[n+2]^=255;break;default:for(var l,g,s,m,v=t-4,d=0,f=[4096],u=1;32>u;u++)for(var h=3*u,p=2*u*u,n=0;h>=n;n++)f[128*(u-1)+n]=255*Math.exp(-n*n/p);for(var b=0;i>b;b++)for(var x=0;a>x;x++){m=0,l=g=s=0;for(var y=Math.max(x-v,0),w=Math.min(x+v,a-1),S=d-4*Math.abs(y-x),A=y;w>A;A++)gauss=f[Math.abs(A-x)],l+=r[S+0]*gauss,g+=r[S+1]*gauss,s+=r[S+2]*gauss,m+=gauss,S+=4;r[d+0]=l/m,r[d+1]=g/m,r[d+2]=s/m,d+=4}}isNaN(e.etcv)&&(e.etcv=document.createElement("canvas"),e.etcv.id=uniqueID(),e.etcv.width=a,e.etcv.height=i,e.etcx=e.etcv.getContext("2d"),!e.etcx),c.data=r,e.etcx.putImageData(c,0,0)}else{var _=document.getElementById(e.etcv.id);document.body.removeChild(_),e.etcv.id=null,e.etcv=NaN,e.etcx=NaN}}function DrawSub(e){if(3===e.eof&&0==(1&e.status)){var t=ctx[BackNo],a=e.cv.width,i=e.cv.height,c=e.scale,r=e.x+e.ex,n=e.y+e.ey;if(e.mflag&&(a=e.movie.videoWidth,i=e.movie.videoHeight),1!=c&&(r-=(a*c-a)/2,n-=(i*c-i)/2),t.globalAlpha=e.alpha,e.rz){var o=e.rz*Math.PI/256;t.save(),t.setTransform(Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),a/2,i/2),t.translate(-(a/2),-(i/2))}switch(e.render){case 1:t.globalCompositeOperation="lighter";break;case 2:}var l;l=e.filter?e.etcv:e.mflag?e.movie:e.cv,t.drawImage(l,0,0,a,i,r,n,a*c,i*c),e.render&&(t.globalCompositeOperation="source-over"),e.rz&&t.restore()}}function Draw(){ActSub();var e=(cv1.clientWidth/cv1.width,ctx[BackNo]);e.fillStyle="rgb(0,0,0)",e.fillRect(0,0,cv1.width,cv1.height),TextFlag?(icg[TextLayer].status=0,icg[TextLayer].ctx.drawImage(cv[2],namearea[0]/SmaiiRate,namearea[1]/SmaiiRate),TextAnime()):icg[TextLayer].status=1;for(var t=0;t<=tbaseL;t++)DrawSub(icg[t]);e.globalAlpha=1,btnFnc(e);for(var t=tbaseL+1;t<full_layer;t++)DrawSub(icg[t]);if(e.globalAlpha=1,FadeFlag?(ctx1.globalAlpha=1-FadeAlpha,ctx1.drawImage(cv[1^BackNo],0,0),ctx1.globalAlpha=FadeAlpha,movie_flag?ctx1.drawImage(movie,0,0,movie.videoWidth,movie.videoHeight,0,0,movie.videoWidth/SmaiiRate,movie.videoHeight/SmaiiRate):ctx1.drawImage(cv[BackNo],0,0),ctx1.globalAlpha=1):movie_flag?ctx1.drawImage(movie,0,0,movie.videoWidth,movie.videoHeight,0,0,movie.videoWidth/SmaiiRate,movie.videoHeight/SmaiiRate):ctx1.drawImage(cv[BackNo],0,0),selFlag)for(var a=selCg.cv.height/2,i=selCg.cv.width,t=0;t<selData.length;t++)mouse_x>selX[t]&&mouse_x<selX[t]+i&&mouse_y>selY[t]&&mouse_y<selY[t]+a?ctx1.drawImage(selCg.cv,0,a,i,a,selX[t],selY[t],i,a):ctx1.drawImage(selCg.cv,0,0,i,a,selX[t],selY[t],i,a),ctx1.fillStyle=textCol,ctx1.fillText(selData[t],selX[t]+selOffX/SmaiiRate,selY[t]+selOffY/SmaiiRate);WaitAniFlag&&WaitAnime(),FlashFlag&&(ctx1.fillStyle=FlashColor,ctx1.fillRect(0,0,cv1.width,cv1.height)),FPSdraw()}function SubProc(e){for(var t=0;subNo>t;t++)if(sub_dat[t]==e)return t+1;return 0}function btnChk(){for(var e=0;e<btng.length;e++)if(void 0!=btng[e]&&0==(3&btng[e].status))for(var t=btng[e].btn.length-1;t>=0;t--)if(void 0!=btng[e].btn[t]){var a=btng[e].btn[t];if(void 0!=a.cg&&0==(30&a.status)){var i=a.cg.x,c=a.cg.y,r=a.width,n=a.h_offset;if(mouse_x>i&&i+r>mouse_x&&mouse_y>c&&c+n>mouse_y){var o=1;if(65536&a.option){var l=a.cg.ctx.getImageData(mouse_x-i,mouse_y-c,1,1),g=l.data;0==g[3]&&(o=0)}if(o)return e<<16|t}}}return-1}function btnSub(){var e=btnChk();if(-1!=e){for(var t=e>>16,a=65535&e,i=0;i<btng.length;i++)if(void 0!=btng[i]&&void 0!=btng[i].btn)for(var c=0;c<btng[i].btn.length;c++)void 0!=btng[i].btn[c]&&(i==t&&c==a||(btng[i].btn[c].status&=65534));0==(3&btng[t].btn[a].status)&&(void 0!=btng[t].on_se&&btng[t].on_se.play(),btng[t].btn[a].status|=1),btng[t].btn[a].click&&(btng[t].btn[a].status|=2,void 0!=btng[t].click_se&&btng[t].click_se.play(),bclk=1,btng[t].btn[a].click=0,stack.push(sc_step),stackBr.push(brNode),stackNo++,bracketF[brNode]=1,sc_step=sub_add[SubProc(btng[t].btn[a].click_mouse)-1],ClickFlag=0)}else for(var t=btng.length-1;t>=0;t--)if(void 0!=btng[t]&&0==(3&btng[t].status)&&void 0!=btng[t].btn)for(var a=btng[t].btn.length-1;a>=0;a--)void 0!=btng[t].btn[a]&&void 0!=btng[t].btn[a].status&&0==(30&btng[t].btn[a].status)&&(btng[t].btn[a].click&&(btng[t].btn[a].click=0),0==(2&btng[t].btn[a].status)&&1&btng[t].btn[a].status&&(btng[t].btn[a].status^=1))}function btnFnc(e){var t=e.globalAlpha;void 0==t&&(t=1);for(var a=btng.length-1;a>=0;a--)if(void 0!=btng[a])for(var i=btng[a].btn.length-1;i>=0;i--)if(void 0!=btng[a].btn[i]){var c=btng[a].btn[i];if(0==(12&c.status)){e.globalAlpha=c.cg.alpha;var r=c.cg.x,n=c.cg.y,o=c.width,l=c.h_offset;4==c.style?NameTagUse&&VoiceName.length?2&c.status?c.height>=l+l?e.drawImage(c.cg.cv,0,l+l,o,l,r,n,o,l):e.drawImage(c.cg.cv,0,l,o,l,r,n,o,l):1&c.status?e.drawImage(c.cg.cv,0,l,o,l,r,n,o,l):e.drawImage(c.cg.cv,0,0,o,l,r,n,o,l):e.drawImage(c.cg.cv,0,3*l,o,l,r,n,o,l):2&c.status?c.height>=l+l?e.drawImage(c.cg.cv,0,l+l,o,l,r,n,o,l):e.drawImage(c.cg.cv,0,l,o,l,r,n,o,l):1&c.status?e.drawImage(c.cg.cv,0,l,o,l,r,n,o,l):e.drawImage(c.cg.cv,0,0,o,l,r,n,o,l)}}e.globalAlpha=t}function btnClr(){for(var e=btng.length-1;e>=0;e--)if(void 0!=btng[e])for(var t=btng[e].btn.length-1;t>=0;t--)if(void 0!=btng[e].btn[t]){var a=btng[e].btn[t];16&a.status&&(2&a.status&&(a.status^=2),a.cg.eof=0,cg_del(a.cg),a.ctx=null,delete a.cv,a.cv=null,delete a.cg,delete a,btng[e].btn.splice(t,1),t--)}for(var e=0;e<btng.length;e++)void 0!=btng[e]&&16&btng[e].status&&(void 0!=btng[e].on_se&&(btng[e].on_se.pause(),btng[e].on_se.src=""),void 0!=btng[e].click_se&&(btng[e].click_se.pause,btng[e].click_se.src=""),delete btng[e],btng.splice(e,1),e--)}function run(){for(var e=0;e<btng.length;e++)if(void 0!=btng[e])for(var t=0;t<btng[e].btn.length;t++)void 0!=btng[e].btn[t]&&8&btng[e].btn[t].status&&(btng[e].btn[t].status^=8);btnClr();for(var t=0;t<full_layer;t++)icg[t].x=cg[t].x,icg[t].y=cg[t].y,icg[t].ex=cg[t].ex,icg[t].ey=cg[t].ey,icg[t].alpha=cg[t].alpha,icg[t].eof=cg[t].eof,icg[t].render=cg[t].render,icg[t].scale=cg[t].scale,icg[t].rx=cg[t].rx,icg[t].ry=cg[t].ry,icg[t].rz=cg[t].rz,icg[t].status=cg[t].status,icg[t].filter=cg[t].filter,icg[t].filter&&set_filter(icg[t],icg[t].filter),cg[t].mflag?(1===cg[t].mflag&&(cg[t].mflag=2,icg[t].movie=document.createElement("video"),icg[t].id=uniqueID(),icg[t].movie.src=cg[t].movie.src,icg[t].movie.loop=cg[t].movie.loop,icg[t].movie.preload=cg[t].movie.preload,icg[t].movie.play()),icg[t].mflag=2):(icg[t].cv.width=cg[t].cv.width,icg[t].cv.height=cg[t].cv.height,icg[t].ctx=icg[t].cv.getContext("2d"),!icg[t].ctx,icg[t].ctx.clearRect(0,0,cg[t].cv.width,cg[t].cv.height),3===cg[t].eof&&icg[t].ctx.drawImage(cg[t].cv,0,0));FaceFlag&&(cg[FaceLayer].status=0,icg[FaceLayer].status=0)}function ActSub(){for(var e=(new Date).getTime(),t=0;t<acl.length;t++)if(1&acl[t].status){var a=acl[t].act_no;if(-1==acl[t].time||e-acl[t].timeS<acl[t].time){if(acl[t].act.length>a){var i=acl[t].act[a],c=i.cmd;i.NowTime=e,e-i.timeS>i.time&&(i.NowTime=i.timeS+i.time),actf[c](i),e-i.timeS>=i.time&&(acl[t].act.length>a+1?(acl[t].act_no++,a++,i=acl[t].act[a],acl[t].act[a].timeS=e,c=i.cmd,acti[c](i)):2&acl[t].status&&0!=acl[t].loop&&(-1!=acl[t].loop&&acl[t].loop--,acl[t].loop&&(acl[t].act_no=0,a=0,i=acl[t].act[a],acl[t].act[a].timeS=e,c=i.cmd,acti[c](i))))}}else 2&acl[t].status&&0!=acl[t].loop?(-1!=acl[t].loop&&acl[t].loop--,acl[t].loop?(acl[t].act_no=0,a=0,i=acl[t].act[a],c=i.cmd,acti[c](i)):acl[t].status^=1):acl[t].status^=1}}function AdvStraight(e,t){var a=e/t;return a>1&&(a=1),a}function AdvAccele(e,t){var a=55*Math.log10((t-e)/t)*-.01;return a>1&&(a=1),a}function AdvDecele(e,t){var a=80*Math.log10(e/t)*-.01;return a>1&&(a=1),1-a}function AdvAcceleDecele(e,t){var a=e/t;return a=Math.sin(128*a/256*Math.PI),a>1&&(a=1),a}function var_set(e,t){var a=varfnd(e);-1!=a?var_data[a]=t:(var_name.push(e),var_node.push(brNode),var_data.push(t),var_cnt++)}function varGet(e){return d=varfnd(e),-1!=d?isNaN(var_data[d])?var_data[d]:Number(var_data[d]):isNaN(e)?e:Number(e)}function FitWin(e){e?WinFit||0!=isIE&&11!=ieVersion||(AddViewPort("viewport","width=device-width,initial-scale=1.0"),addStyleRule("canvas","max-width: auto; height: auto; width: 100%;"),WinFit=1):!WinFit||0!=isIE&&11!=ieVersion||(DelViewPort("viewport"),DelStyleRule("canvas"),WinFit=0)}function GetNameTag(){for(var e=0;e<btng.length;e++)if(void 0!=btng[e])for(var t=0;t<btng[e].btn.length;t++)if(void 0!=btng[e].btn[t]&&4==btng[e].btn[t].style)return e<<16|t;return-1}function NameTag(e){var t=GetNameTag();if(-1!=t){var a=t>>16;t&=65535,e?4&btng[a].btn[t].status&&(btng[a].btn[t].status^=4):btng[a].btn[t].status|=4}}function FullCG(e){}function ActClr(e){for(;acl[e].act.length;)acl[e].act.pop();acl[e].act_no=0,acl[e].act_cnt=0,acl[e].time=0,acl[e].timeS=0,acl[e].loop=0,acl[e].status=0}function ActClrAll(){for(var e=0;e<acl.length;e++)ActClr(e)}var BackNo=0,cno=0,SelAlpha,ScRead=0,ScLoop=1,OrgWid,script=[],var_data=[],var_name=[],var_node=[],var_cnt=0,lab_dat=[],lab_add=[],labNo=0,selCg,selData=[],selLabel=[],selX=[],selY=[],selFlag=0,bracketF=[],bracketS=[],bracketE=[],bracketP=[],brNo=0,brNode=0,subFlag=0,subNo=0,sub_dat=[],sub_add=[],sub_param=[],start_add=0,stack=[],stackNo=0,stackBr=[],action=function(){},actline=function(){},acl=[],actf=[],acti=[],pict=function(){},btnGrp=function(){Array()},btnfc=function(){},NameTagFlag=0,VoiceName,cg=[],icg=[],btng=[],waitpos=[500,680],sc_step=0,read_task=0,cv1,cv=new Array(5),ctx1,ctx=new Array(5),lno,x,y,alpha,OrgInv1,OrgInv2,bgm=new Array(max_bgm),se=new Array(max_se),voi=new Array(max_voi),bgmFadeS=0,voiFadeS=0,seFadeS=0,bgmFadeT=0,voiFadeT=0,seFadeT=0,isMobile,isIE,isMP3=0,ieVersion,isFOX,key_off=0,ClickFlag,Wait,StartTime,wAnime=-1,SwAnime,wAniW,wAniH,WaitCg,WaitAniFlag=0,DrawFlag=0,TextFlag=0,NameMoji,TextMoji,TextSize,TextStime,TextDno,tAnimeNow,ShakeFlag,ShakeStart,ShakeTime,ShakeRenge,ShakeOption,ShakeType,FlashFlag,FlashStart,FlashTime,FlashR,FlashG,FlashB,FlashColor,tbaseX,tbaseY,tbaseS,movie,movie_flag=0,movie_stime,movie_loop=0,meffect,meffect_flag=0,sno=0,FadeFlag=0,FadeTime,FadeNow,FadeAlpha,mouse_x,mouse_y,FPSStart,FPScnt,FPSdisp,FaceX,FaceY,FaceOX,FaceOY,FaceFlag=0,PlaySeCh,WinFit=0,sc_wait=0,vm_wait=0,se_wait=0,se_ch=0,SkipFlag=0,act_sync=0,act_syncNo=0,act_syncA=0,run_wait=0;onload=function(){if(!isCanvasSupported())return void alert("ご使用のブラウザーはHTML5に未対応です。");var e=window.navigator.userAgent.toLowerCase();if(ieVersion=0,isMobile=!1,e.match(/android|ipad|ipod|iphone|mobile/)&&(isMobile=!0),e.match(/(msie|MSIE)/)||e.match(/(T|t)rident/)){isIE=!0;var t=e.match(/(msie\s|rv:)([\d\.]+)/)[3];ieVersion=parseInt(t)}else isIE=!1;isFOX=-1!=e.indexOf("firefox"),isMP3=!1;var a=document.createElement("audio");""!=a.canPlayType("audio/mpeg")&&(isMP3=!0),FitWin(0),BackNo=0,ScRead=0,ScLoop=1,ReadFile("script.txt"),OrgInv2=setInterval(vm_draw,1e3/30),OrgInv1=setInterval(sc_run,1)},acti.fade=function(e){e.spm[0]=Math.floor(255*icg[e.layer].alpha)},actf.fade=function(e){var t=e.spm[0]+e.prm[0]*(e.NowTime-e.timeS)/e.time;t>255&&(t=255),0>t&&(t=0),icg[e.layer].alpha=t/255,cg[e.layer].alpha=t/255},acti.btn=function(e){var t=e.layer>>16,a=65535&e.layer;e.spm[0]=Math.floor(255*btng[t].btn[a].cg.alpha)},actf.btn=function(e){var t=e.layer>>16,a=65535&e.layer,i=e.spm[0]+e.prm[0]*(e.NowTime-e.timeS)/e.time;i>255&&(i=255),0>i&&(i=0),btng[t].btn[a].cg.alpha=i/255},acti.straight=function(e){e.spm[0]=icg[e.layer].x,e.spm[1]=icg[e.layer].y},actf.straight=function(e){var t=e.prm[0]*(e.NowTime-e.timeS)/e.time,a=e.prm[1]*(e.NowTime-e.timeS)/e.time;icg[e.layer].x=e.spm[0]+t,icg[e.layer].y=e.spm[1]+a,cg[e.layer].x=e.spm[0]+t,cg[e.layer].y=e.spm[1]+a},acti.straight2=function(e){e.spm[0]=icg[e.layer].x,e.spm[1]=icg[e.layer].y},actf.straight2=function(e){var t=e.prm[0]*AdvAcceleDecele(e.NowTime-e.timeS,e.time),a=e.prm[1]*AdvAcceleDecele(e.NowTime-e.timeS,e.time);icg[e.layer].x=e.spm[0]+t,icg[e.layer].y=e.spm[1]+a,cg[e.layer].x=e.spm[0]+t,cg[e.layer].y=e.spm[1]+a},acti.accele=function(e){e.spm[0]=icg[e.layer].x,e.spm[1]=icg[e.layer].y},actf.accele=function(e){var t=e.prm[0]*AdvAccele(e.NowTime-e.timeS,e.time),a=e.prm[1]*AdvAccele(e.NowTime-e.timeS,e.time);icg[e.layer].x=e.spm[0]+t,icg[e.layer].y=e.spm[1]+a,cg[e.layer].x=e.spm[0]+t,cg[e.layer].y=e.spm[1]+a},acti.decele=function(e){e.spm[0]=icg[e.layer].x,e.spm[1]=icg[e.layer].y},actf.decele=function(e){var t=e.prm[0]*AdvDecele(e.NowTime-e.timeS,e.time),a=e.prm[1]*AdvDecele(e.NowTime-e.timeS,e.time);icg[e.layer].x=e.spm[0]+t,icg[e.layer].y=e.spm[1]+a,cg[e.layer].x=e.spm[0]+t,cg[e.layer].y=e.spm[1]+a},acti.shake=function(e){e.spm[0]=icg[e.layer].ex,e.spm[1]=icg[e.layer].ey},actf.shake=function(e){var t=(e.NowTime-e.timeS)/e.time;t>1&&(t=1,e.timeS=e.NowTime);var a=(Math.sin(360*t*Math.PI/180),e.prm[0]),i=e.prm[1];switch(a){case 0:icg[e.layer].ey=Math.floor(Math.random()*i),cg[e.layer].ey=Math.floor(Math.random()*i);break;case 1:icg[e.layer].ex=Math.floor(Math.random()*i),cg[e.layer].ex=Math.floor(Math.random()*i);break;case 2:icg[e.layer].ey=Math.floor(Math.random()*i),icg[e.layer].ex=Math.floor(Math.random()*i),cg[e.layer].ey=Math.floor(Math.random()*i),cg[e.layer].ex=Math.floor(Math.random()*i)}},acti.shake2=function(e){e.spm[0]=icg[e.layer].ex,e.spm[1]=icg[e.layer].ey},actf.shake2=function(e){var t=(e.NowTime-e.timeS)/e.time;t>1&&(t=1,e.timeS=e.NowTime);var a=Math.sin(360*t*Math.PI/180),i=e.prm[0],c=e.prm[1];switch(i){case 0:icg[e.layer].ey=Math.floor(a*c),cg[e.layer].ey=Math.floor(a*c);break;case 1:icg[e.layer].ex=Math.floor(a*c),cg[e.layer].ex=Math.floor(a*c);break;case 2:t=1-(e.NowTime-e.timeS)/e.prm[2],t>1&&(t=1,e.timeS=e.NowTime),icg[e.layer].ey=Math.floor(a*c*t),cg[e.layer].ey=Math.floor(a*c*t);break;case 3:t=1-(e.NowTime-e.timeS)/e.prm[2],t>1&&(t=1,e.timeS=e.NowTime),icg[e.layer].ex=Math.floor(a*c*t),cg[e.layer].ex=Math.floor(a*c*t)}},acti.wait=function(){},actf.wait=function(){},acti.rotate=function(e){e.spm[0]=icg[e.layer].rx,e.spm[1]=icg[e.layer].ry,e.spm[2]=icg[e.layer].rz},actf.rotate=function(e){var t=(e.NowTime-e.timeS)/e.time,a=e.spm[0]+Math.floor(e.prm[0]*t),i=e.spm[1]+Math.floor(e.prm[1]*t),c=e.spm[2]+Math.floor(e.prm[2]*t);a>512&&(a-=512),i>512&&(i-=512),c>512&&(c-=512),icg[e.layer].rx=a,icg[e.layer].ry=i,icg[e.layer].rz=c,cg[e.layer].rx=a,cg[e.layer].ry=i,cg[e.layer].rz=c},acti.rotate_ex=function(e){e.spm[0]=icg[e.layer].rx,e.spm[1]=icg[e.layer].ry,e.spm[2]=icg[e.layer].rz},actf.rotate_ex=function(e){var t;switch(e.prm[0]){case 0:t=AdvStraight(e.NowTime-e.timeS,e.time);break;case 1:t=AdvAccele(e.NowTime-e.timeS,e.time);break;case 2:t=AdvDecele(e.NowTime-e.timeS,e.time);break;case 3:t=AdvAcceleDecele(e.NowTime-e.timeS,e.time)}var a=e.spm[0]+Math.floor(e.prm[1]*t),i=e.spm[1]+Math.floor(e.prm[2]*t),c=e.spm[2]+Math.floor(e.prm[3]*t);a>512&&(a-=512),i>512&&(i-=512),c>512&&(c-=512),icg[e.layer].rx=a,icg[e.layer].ry=i,icg[e.layer].rz=c,cg[e.layer].rx=a,cg[e.layer].ry=i,cg[e.layer].rz=c},acti.scale=function(e){e.spm[0]=icg[e.layer].scale},actf.scale=function(e){var t=cg[e.layer].cv.width,a=cg[e.layer].cv.height,i=e.spm[0]+e.prm[0]*(e.NowTime-e.timeS)/e.time/100;icg[e.layer].scale=i,icg[e.layer].ex=-(t*i-t)/2,icg[e.layer].ey=-(a*i-a)/2,cg[e.layer].scale=i,cg[e.layer].ex=-(t*i-t)/2,cg[e.layer].ey=-(a*i-a)/2},acti.scale_ex=function(e){e.spm[0]=icg[e.layer].scale},actf.scale_ex=function(e){var t,a=cg[e.layer].cv.width,i=cg[e.layer].cv.height;switch(e.prm[0]){case 0:t=e.spm[0]+e.prm[1]*AdvStraight(e.NowTime-e.timeS,e.time)/100;break;case 1:t=e.spm[0]+e.prm[1]*AdvAccele(e.NowTime-e.timeS,e.time)/100;break;case 2:t=e.spm[0]+e.prm[1]*AdvDecele(e.NowTime-e.timeS,e.time)/100;break;case 3:t=e.spm[0]+e.prm[1]*AdvAcceleDecele(e.NowTime-e.timeS,e.time)/100}icg[e.layer].scale=t,icg[e.layer].ex=-(a*t-a)/2,icg[e.layer].ey=-(i*t-i)/2,cg[e.layer].scale=t,cg[e.layer].ex=-(a*t-a)/2,cg[e.layer].ey=-(i*t-i)/2},acti.movepos=function(e){e.spm[0]=icg[e.layer].x,e.spm[1]=icg[e.layer].y},actf.movepos=function(){};